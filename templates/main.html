<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUCourseFinder</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z9RFLM5XHG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-Z9RFLM5XHG');
    </script>
    
    <style>
        :root {
            --rutgers-red: #cc0033;
            --rutgers-red-dark: #a50029;
            --gray-100: #f9f9f9;
            --gray-200: #eee;
            --gray-300: #ddd;
            --gray-400: #ccc;
            --gray-500: #999;
            --gray-600: #666;
            --gray-700: #555;
            --gray-800: #333;
            --shadow-sm: 0 2px 10px rgba(0,0,0,0.05);
            --shadow-md: 0 5px 15px rgba(0,0,0,0.1);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 15px;
        }

        body {
           font-family: 'Roboto', sans-serif;
           line-height: 1.6;
           padding: 0;
           margin: 0;
           background-color: var(--gray-100);
           color: var(--gray-800);
       }

       .top-banner {
           background-color: #cc0033;
           color: white;
           padding: 2rem 0;
           margin-bottom: 2rem;
       }

       .top-banner h1 {
           color: white;
           margin-bottom: 1rem;
       }

       .top-banner h3 {
           color: white;
           font-weight: 300;
           margin-bottom: 1rem;
           max-width: 800px;
           margin-left: auto;
           margin-right: auto;
       }

       .top-banner p {
           color: white;
           margin: 0;
       }

       .navbar {
           background-color: #cc0033;
           padding: 1rem;
           box-shadow: 0 2px 4px rgba(0,0,0,0.1);
       }

       .navbar-container {
           max-width: 1200px;
           margin: 0 auto;
           display: flex;
           flex-direction: column;
           gap: 1rem;
       }

       .navbar-top {
           display: flex;
           justify-content: space-between;
           align-items: center;
       }

       .navbar-brand {
           color: white;
           text-decoration: none;
           font-size: 1.5rem;
           font-weight: bold;
       }

       .navbar-links {
           display: flex;
           gap: 1.5rem;
       }

       .navbar-links a {
           color: white;
           text-decoration: none;
           padding: 0.5rem 1rem;
           border-radius: 4px;
           transition: background-color 0.3s;
       }

       .navbar-links a:hover {
           background-color: rgba(255,255,255,0.1);
       }

       .navbar-description {
           color: white;
           text-align: center;
           max-width: 800px;
           margin: 0 auto;
       }

       .navbar-description h3 {
           color: white;
           font-size: 16px;
           font-weight: 300;
           margin: 0 0 0.5rem 0;
       }

       .navbar-description p {
           color: white;
           margin: 0;
           font-size: 14px;
       }

       .container {
           max-width: 1200px;
           margin: 0 auto;
           padding: 0 20px;
       }

       h1 {
           font-size: 24px;
           margin-bottom: 10px;
       }

       h3 {
           font-size: 16px;
           font-weight: 300;
           margin-top: 0;
       }

       #search-form {
           display: flex;
           justify-content: center;
           align-items: center;
           margin: 40px 0;
       }

       .toggle-container {
           margin-right: 10px;
       }

       #search-bar {
           width: 400px;
           padding: 12px;
           margin-top: -10px;
           font-size: 16px;
           border: 1px solid #ddd;
           border-radius: 4px 0 0 4px;
           outline: none;
       }

       #search-button {
           padding: 12px 20px;
           margin-top: -10px;
           font-size: 16px;
           background-color: #cc0033;
           color: white;
           border: none;
           border-radius: 0 4px 4px 0;
           cursor: pointer;
           transition: background-color 0.3s;
       }

       #search-button:hover {
           background-color: #a50029;
       }

       .loading {
           display: none;
           margin-top: 20px;
           text-align: center;
       }

       .spinner {
           border: 4px solid #f3f3f3;
           border-top: 4px solid #cc0033;
           border-radius: 50%;
           width: 40px;
           height: 40px;
           animation: spin 1s linear infinite;
           margin: 0 auto;
       }

       @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
       }

       #search-results {
           margin-top: 40px;
           padding: 0 20px;
       }

       .course {
           background-color: white;
           margin-bottom: 8px;
           padding: 8px;
           border-radius: var(--radius-sm);
           box-shadow: var(--shadow-sm);
           transition: all 0.3s ease;
           border: 1px solid var(--gray-200);
       }

       .course:hover {
           transform: translateY(-1px);
           box-shadow: var(--shadow-md);
       }

       .course-header {
           display: flex;
           justify-content: space-between;
           align-items: flex-start;
           margin-bottom: 6px;
           padding-bottom: 6px;
           border-bottom: 1px solid var(--gray-200);
       }

       .course-info {
           display: flex;
           align-items: center;
           flex-wrap: wrap;
           gap: 4px;
       }

       .course-title {
           margin: 0;
           color: var(--rutgers-red);
           font-size: 0.9rem;
           font-weight: 600;
           line-height: 1.2;
       }

       .course-code {
           font-family: 'Roboto Mono', monospace;
           color: var(--gray-600);
           font-size: 0.7rem;
           background: var(--gray-100);
           padding: 2px 4px;
           border-radius: 2px;
           margin-left: 4px;
           font-weight: 500;
           letter-spacing: 0.2px;
       }

       .course-section {
           margin: 6px 0;
           padding: 6px;
           background: var(--gray-100);
           border-radius: 3px;
           border: 1px solid var(--gray-200);
       }

       .section-title {
           font-size: 0.65rem;
           font-weight: 600;
           color: var(--gray-700);
           margin-bottom: 4px;
           text-transform: uppercase;
           letter-spacing: 0.6px;
       }

       .professor-list {
           list-style: none;
           padding: 0;
           margin: 0;
           display: flex;
           flex-wrap: wrap;
           gap: 3px;
       }

       .professor-item {
           display: inline-block;
           background: white;
           padding: 2px 5px;
           border-radius: 8px;
           font-size: 0.7rem;
           border: 1px solid var(--gray-200);
           color: var(--gray-700);
           transition: all 0.2s ease;
       }

       .professor-item:hover {
           background: var(--gray-100);
           border-color: var(--gray-300);
       }

       .prerequisites {
           color: var(--gray-700);
           line-height: 1.3;
           font-size: 0.75rem;
       }

       .equivalencies {
           margin-top: 6px;
           padding-top: 6px;
           border-top: 1px solid var(--gray-200);
       }

       .equivalency-item {
           display: flex;
           align-items: center;
           margin-bottom: 3px;
           padding: 4px;
           background: var(--gray-100);
           border-radius: 3px;
           transition: all 0.2s ease;
       }

       .equivalency-item:hover {
           background: white;
           box-shadow: var(--shadow-sm);
       }

       .college-name {
           flex: 1;
           font-weight: 500;
           color: var(--gray-800);
           font-size: 0.75rem;
       }

       .distance {
           color: var(--gray-600);
           font-size: 0.7rem;
           margin: 0 4px;
           white-space: nowrap;
       }

       .course-code-equiv {
           font-family: 'Roboto Mono', monospace;
           background: white;
           padding: 1px 3px;
           border-radius: 2px;
           font-size: 0.7rem;
           border: 1px solid var(--gray-200);
           color: var(--gray-700);
           white-space: nowrap;
       }

       .error-message {
           color: #cc0033;
           text-align: center;
           padding: 20px;
           background-color: #fff;
           border-radius: 4px;
           box-shadow: 0 2px 5px rgba(0,0,0,0.1);
           margin: 20px 0;
       }

       .no-results {
           text-align: center;
           padding: 40px;
           background: white;
           border-radius: var(--radius-md);
           color: var(--gray-600);
           font-size: 1.1rem;
           margin: 40px 0;
           border: 2px dashed var(--gray-200);
       }

       .catalog-link {
           display: inline-flex;
           align-items: center;
           gap: 3px;
           padding: 4px 6px;
           background-color: var(--gray-100);
           color: var(--gray-700);
           text-decoration: none;
           border-radius: 3px;
           font-size: 0.7rem;
           border: 1px solid var(--gray-200);
           transition: all 0.2s ease;
       }

       .catalog-link:hover {
           background-color: white;
           border-color: var(--rutgers-red);
           color: var(--rutgers-red);
       }

       .catalog-link i {
           font-size: 0.6rem;
       }

       @media (max-width: 768px) {
           .container {
               padding: 0 10px;
           }

           #search-results {
               padding: 0 10px;
           }

           .course {
               padding: 6px;
               margin-bottom: 6px;
           }

           .course-header {
               flex-direction: column;
               gap: 4px;
           }

           .course-code {
               margin-left: 0;
               margin-top: 2px;
               display: inline-block;
           }

           .course-section {
               padding: 4px;
               margin: 4px 0;
           }

           .equivalency-item {
               flex-direction: column;
               align-items: flex-start;
               gap: 2px;
               padding: 3px;
           }

           .distance, .course-code-equiv {
               margin-left: 0;
           }

           .professor-list {
               gap: 2px;
           }

           .catalog-link {
               align-self: flex-start;
               margin-top: 2px;
           }
       }
   </style>
</head>

<body>
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-top">
                <a href="/" class="navbar-brand">RUCourseFinder</a>
                <div class="navbar-links">
                    <a href="/" style="background-color: rgba(255,255,255,0.1);">Course Search</a>
                    <a href="/chatbot">Course Chatbot</a>
                </div>
            </div>
            <div class="navbar-description">
                <h3>
                    Unlike WebReg, this platform allows you to search courses by title (leveraging vector embeddings for semantic search), professor, and course code, while also finding equivalent Rutgers courses from New Jersey's community colleges with ease.
                </h3>
                <p><strong>Disclaimer:</strong> This platform is not affiliated with Rutgers University.</p>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <form id="search-form">
            <div class="form-group">
                <div class="toggle-container">
                    <label for="toggle-course-title">
                        <input type="radio" name="search-option" id="toggle-course-title" class="toggle-radio" checked> Search by Course Title
                    </label>
                    <label for="toggle-professor">
                        <input type="radio" name="search-option" id="toggle-professor" class="toggle-radio"> Search Courses by Professor
                    </label>
                    <label for="toggle-course-code">
                        <input type="radio" name="search-option" id="toggle-course-code" class="toggle-radio"> Search by Course Code
                    </label>
                </div>
            </div>
            <div class="form-group">
                <input type="text" id="search-bar" placeholder="Enter course title (e.g., Calculus)" />
            </div>
            <div class="form-group">
                <button type="submit" id="search-button">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
        </form>
    </div>

    <div class="loading">
        <div class="spinner"></div>
        <p>Loading results...</p>
    </div>

    <div id="search-results"></div>

    <script>
        let currentSearchType = 'title'; 

        document.getElementById('toggle-course-title').addEventListener('change', function() {
            currentSearchType = 'title';
            document.getElementById('search-bar').placeholder = "Enter course title (e.g., Calculus)";
        });

        document.getElementById('toggle-professor').addEventListener('change', function() {
            currentSearchType = 'professor';
            document.getElementById('search-bar').placeholder = "Enter professor last name (e.g., Smith)";
        });

        document.getElementById('toggle-course-code').addEventListener('change', function() {
            currentSearchType = 'code';
            document.getElementById('search-bar').placeholder = "Enter last 3 digits of course code (e.g., 101)";
        });

        window.onload = function() {
             getLocation();
        };

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(sendPosition, showError);
            } else {
                document.getElementById("location").innerHTML = "Geolocation is not supported by this browser.";
            }
        }

        function sendPosition(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;

            fetch('/save_location', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    latitude: latitude,
                    longitude: longitude
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    console.log("User denied the request for Geolocation.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    console.log("Location information is unavailable.");
                    break;
                case error.TIMEOUT:
                    console.log("The request to get user location timed out.");
                    break;
                case error.UNKNOWN_ERROR:
                    console.log("An unknown error occurred.");
                    break;
            }
        }

        document.getElementById('search-form').addEventListener('submit', function(event) {
            event.preventDefault();
            clearSearch();
            search();
        });

        function clearSearch() {
            var resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';
        }

        function search() {
            var searchTerm = document.getElementById('search-bar').value;
            var loadingElement = document.querySelector('.loading');
            var resultsContainer = document.getElementById('search-results');

            if (!searchTerm.trim()) {
                resultsContainer.innerHTML = '<p class="error-message">Please enter a search term.</p>';
                return;
            }

            loadingElement.style.display = 'block';
            resultsContainer.innerHTML = '';

            const cacheKey = `${currentSearchType}:${searchTerm}`; 
            const cachedResults = localStorage.getItem(cacheKey);

            if (cachedResults) {
                displayCourses(JSON.parse(cachedResults));
                loadingElement.style.display = 'none'; 
                return; 
            }

            let endpoint;
            switch(currentSearchType) {
                case 'title':
                    endpoint = '/search_by_title';
                    break;
                case 'professor':
                    endpoint = '/search_by_professor';
                    break;
                case 'code':
                    endpoint = '/search_by_code';
                    break;
                default:
                    endpoint = '/search_by_title';
            }

            fetch(endpoint, {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ searchTerm: searchTerm }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'error') {
                    resultsContainer.innerHTML = `<p class="error-message">${data.message}</p>`;
                    return;
                }
                
                if (currentSearchType === 'title' || currentSearchType === 'code') {
                    if (data.courses && data.courses.length > 0) {
                        displayCourses(data.courses);
                        localStorage.setItem(cacheKey, JSON.stringify(data.courses));
                    } else {
                        resultsContainer.innerHTML = '<p class="no-results">No courses found matching your search.</p>';
                    }
                } else {
                    if (data.results && data.results.length > 0) {
                        displayProfessorResults(data.results);
                    } else {
                        resultsContainer.innerHTML = '<p class="no-results">No professors found matching your search.</p>';
                    }
                }
            })
            .catch((error) => {
                console.error('Error:', error);
                resultsContainer.innerHTML = '<p class="error-message">An error occurred while searching. Please try again.</p>';
            })
            .finally(() => {
                loadingElement.style.display = 'none';
            });
        }

        function displayCourses(courses) {
            var coursesContainer = document.getElementById('search-results');
            coursesContainer.innerHTML = '';

            if (courses.length > 0) {
                courses.forEach(course => {
                    var courseDiv = document.createElement('div');
                    courseDiv.className = 'course';

                    // Course Header
                    var headerDiv = document.createElement('div');
                    headerDiv.className = 'course-header';
                    
                    var titleDiv = document.createElement('div');
                    titleDiv.className = 'course-info';
                    var titleSpan = document.createElement('span');
                    titleSpan.className = 'course-title';
                    titleSpan.textContent = course.title;
                    
                    var codeSpan = document.createElement('span');
                    codeSpan.className = 'course-code';
                    codeSpan.textContent = course.course_number;
                    
                    var catalogLink = document.createElement('a');
                    catalogLink.href = course.synopsisUrl || '#';
                    catalogLink.className = 'catalog-link';
                    catalogLink.target = '_blank';
                    catalogLink.rel = 'noopener noreferrer';
                    
                    if (course.synopsisUrl && course.synopsisUrl.trim() !== '') {
                        catalogLink.innerHTML = '<i class="fas fa-external-link-alt"></i> Course Details';
                    } else {
                        catalogLink.innerHTML = '<i class="fas fa-info-circle"></i> Details Not Available';
                        catalogLink.style.pointerEvents = 'none';
                        catalogLink.style.opacity = '0.6';
                        catalogLink.style.cursor = 'default';
                        catalogLink.removeAttribute('href');
                        catalogLink.removeAttribute('target');
                        catalogLink.removeAttribute('rel');
                    }
                    
                    titleDiv.appendChild(titleSpan);
                    titleDiv.appendChild(codeSpan);
                    headerDiv.appendChild(titleDiv);
                    headerDiv.appendChild(catalogLink);
                    courseDiv.appendChild(headerDiv);

                    // Professors Section
                    if (course.instructors && course.instructors.length > 0) {
                        var profSection = document.createElement('div');
                        profSection.className = 'course-section';
                        
                        var profTitle = document.createElement('div');
                        profTitle.className = 'section-title';
                        profTitle.textContent = 'Professors';
                        
                        var profList = document.createElement('ul');
                        profList.className = 'professor-list';
                        
                        course.instructors.forEach(instructorGroup => {
                            instructorGroup.forEach(instructor => {
                                var profItem = document.createElement('li');
                                profItem.className = 'professor-item';
                                profItem.textContent = instructor.name;
                                profList.appendChild(profItem);
                            });
                        });
                        
                        profSection.appendChild(profTitle);
                        profSection.appendChild(profList);
                        courseDiv.appendChild(profSection);
                    }

                    // Prerequisites Section
                    var prereqSection = document.createElement('div');
                    prereqSection.className = 'course-section';
                    
                    var prereqTitle = document.createElement('div');
                    prereqTitle.className = 'section-title';
                    prereqTitle.textContent = 'Prerequisites';
                    
                    var prereqContent = document.createElement('div');
                    prereqContent.className = 'prerequisites';
                    prereqContent.textContent = course.prerequisites;
                    
                    prereqSection.appendChild(prereqTitle);
                    prereqSection.appendChild(prereqContent);
                    courseDiv.appendChild(prereqSection);

                    // Equivalencies Section
                    if (course.equivalencies && course.equivalencies.length > 0) {
                        var equivSection = document.createElement('div');
                        equivSection.className = 'equivalencies';
                        
                        var equivTitle = document.createElement('div');
                        equivTitle.className = 'section-title';
                        equivTitle.textContent = 'Community College Equivalencies';
                        equivSection.appendChild(equivTitle);
                        
                        course.equivalencies.forEach(equiv => {
                            var equivItem = document.createElement('div');
                            equivItem.className = 'equivalency-item';
                            
                            var collegeName = document.createElement('span');
                            collegeName.className = 'college-name';
                            collegeName.textContent = equiv.community_college;
                            
                            var distance = document.createElement('span');
                            distance.className = 'distance';
                            distance.textContent = `${equiv.Distance} miles`;
                            
                            var equivCode = document.createElement('span');
                            equivCode.className = 'course-code-equiv';
                            equivCode.textContent = `${equiv.code} ${equiv.name}`;
                            
                            equivItem.appendChild(collegeName);
                            equivItem.appendChild(distance);
                            equivItem.appendChild(equivCode);
                            equivSection.appendChild(equivItem);
                        });
                        
                        courseDiv.appendChild(equivSection);
                    }

                    coursesContainer.appendChild(courseDiv);
                });
            } else {
                var messageElement = document.createElement('div');
                messageElement.className = 'no-results';
                messageElement.textContent = 'No courses found matching your search.';
                coursesContainer.appendChild(messageElement);
            }
        }

        function displayProfessorResults(results) {
            var coursesContainer = document.getElementById('search-results');
            coursesContainer.innerHTML = '';

            if (results.length > 0) {
                for (var i = 0; i < results.length; i++) {
                    var result = results[i];
                    var professorDiv = document.createElement('div');
                    professorDiv.className = 'course';

                    var professorName = document.createElement('h3');
                    professorName.textContent = result.professor;
                    professorDiv.appendChild(professorName);

                    var coursesList = document.createElement('div');

                    for (var j = 0; j < result.courses.length; j++) {
                        var course = result.courses[j];
                        var courseInfo = document.createElement('p');
                        courseInfo.textContent = `${course.courseString} - ${course.title}`;
                        coursesList.appendChild(courseInfo);
                    }

                    professorDiv.appendChild(coursesList);
                    coursesContainer.appendChild(professorDiv);
                }
            } else {
                var messageElement = document.createElement('p');
                messageElement.className = 'no-results';
                messageElement.textContent = 'No professors found.';
                coursesContainer.appendChild(messageElement);
            }
        }
    </script>
</body>
</html> 